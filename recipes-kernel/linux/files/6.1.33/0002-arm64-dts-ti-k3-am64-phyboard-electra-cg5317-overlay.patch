From be64e0a38c86bda224b69dcd6bb52e8cf7df6ea9 Mon Sep 17 00:00:00 2001
From: Spencer Black <sblack@phytec.com>
Date: Wed, 4 Oct 2023 15:29:26 -0700
Subject: [PATCH 2/2] arm64: dts: ti: k3-am64-phyboard-electra: cg5317 overlay

Add a device tree overlay for the cg5317 EVK.

Signed-off-by: Garrett Giordano <ggiordano@phytec.com>
Signed-off-by: Spencer Black <sblack@phytec.com>
---
 arch/arm64/boot/dts/ti/Makefile               |  1 +
 .../ti/k3-am64-phyboard-electra-cg5317.dtso   | 49 +++++++++++++++++++
 2 files changed, 50 insertions(+)
 create mode 100644 arch/arm64/boot/dts/ti/k3-am64-phyboard-electra-cg5317.dtso

diff --git a/arch/arm64/boot/dts/ti/Makefile b/arch/arm64/boot/dts/ti/Makefile
index 0cd33b7a06c7..893a154fa0e3 100644
--- a/arch/arm64/boot/dts/ti/Makefile
+++ b/arch/arm64/boot/dts/ti/Makefile
@@ -61,6 +61,7 @@ dtb-$(CONFIG_ARCH_K3) += k3-am642-sk.dtb
 dtb-$(CONFIG_ARCH_K3) += k3-am642-evm-icssg1-dualemac.dtbo
 dtb-$(CONFIG_ARCH_K3) += k3-am642-evm-icssg1-dualemac-mii.dtbo
 dtb-$(CONFIG_ARCH_K3) += k3-am642-evm-nand.dtbo
+dtb-$(CONFIG_ARCH_K3) += k3-am64-phyboard-electra-cg5317.dtbo
 
 # Boards with AM65x SoC
 dtb-$(CONFIG_ARCH_K3) += k3-am6528-iot2050-basic.dtb
diff --git a/arch/arm64/boot/dts/ti/k3-am64-phyboard-electra-cg5317.dtso b/arch/arm64/boot/dts/ti/k3-am64-phyboard-electra-cg5317.dtso
new file mode 100644
index 000000000000..9f1e9ffbb818
--- /dev/null
+++ b/arch/arm64/boot/dts/ti/k3-am64-phyboard-electra-cg5317.dtso
@@ -0,0 +1,49 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Copyright (C) 2022 PHYTEC America LLC
+ * Author: Garrett Giordano <ggiordano@phytec.com>
+ */
+
+// Overlay for the Lumissil CG5317 on there EVK
+// Visit: https://www.lumissil.com/applications/communication/electric-vehicles-charging/vehicle-charging/is32cg5317 for details
+
+#include <dt-bindings/gpio/gpio.h>
+#include "k3-pinctrl.h"
+
+/dts-v1/;
+/plugin/;
+
+&main_pmx0 {
+	main_spi1_pins_default: main-spi1-pins-default {
+		pinctrl-single,pins = <
+			AM64X_IOPAD(0x0224, PIN_INPUT, 0)	/* (C14) SPI1_CLK */
+			AM64X_IOPAD(0x021C, PIN_OUTPUT, 0)	/* (B14) SPI1_CS0 */
+			AM64X_IOPAD(0x0228, PIN_OUTPUT, 0)	/* (B15) SPI1_D0 */
+			AM64X_IOPAD(0x022C, PIN_INPUT, 0)	/* (A15) SPI1_D1 */
+            AM64X_IOPAD(0x0048, PIN_INPUT, 7)	/* (U20) GPMCO_AD3.GPIO0_18 */
+            AM64X_IOPAD(0x004c, PIN_INPUT, 7)	/* (U18) GPMC0_AD4.GPIO0_82 */
+            AM64X_IOPAD(0x0050, PIN_INPUT, 7)	/* (U19) GPMC0_AD5.GPIO0_83 */
+		>;
+	};
+};
+
+&main_spi1 {
+	/* needed to avoid dtc warning */
+	#address-cells = <1>;
+	#size-cells = <0>;
+
+	pinctrl-names = "default";
+	pinctrl-0 = <&main_spi1_pins_default>;
+	ti,pindir-d0-out-d1-in = <1>;
+	status = "okay";
+
+   cg5317: cg5317@0 {
+        status = "okay";
+        compatible = "cg,cg5317";
+        reg = <0x0>;    /* CE0 */
+        interrupts-extended = <&main_gpio0 82 0x1>, <&main_gpio0 83 0x1>; /* rising edge */
+        interrupt-names = "gp_irq", "rx_irq";
+        spi-cpha;       /* SPI mode: CPHA=1 */
+        spi-max-frequency = <1000000>;
+   };
+};
\ No newline at end of file
-- 
2.25.1

